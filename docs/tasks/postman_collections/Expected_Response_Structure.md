# SwitchAI Enhanced Comparisons - Expected Response Structure

## Overview

This document provides comprehensive documentation for the expected structure and content of Markdown responses generated by the SwitchAI enhanced comparison feature. Use this as a reference for validating test results and ensuring response quality.

## API Response Format

### HTTP Response Structure
```json
{
  "id": "string - unique message identifier",
  "role": "assistant",
  "content": "string - markdown formatted comparison content",
  "metadata": {
    "model": "string - AI model used (e.g., 'gemini-1.5-flash')",
    "isComparison": "boolean - true for comparison responses",
    "comparisonValid": "boolean - true if comparison was successfully generated",
    "comparisonConfidence": "number - confidence score 0-1 for intent detection",
    "switchesCompared": "array - list of switch names actually compared",
    "switchesFoundInDB": "array - switches found in database",
    "missingSwitches": "array - switches not found in database",
    "hasDataGaps": "boolean - true if some data is missing",
    "promptLength": "number - length of prompt sent to LLM",
    "retrievalNotes": "array - notes about data retrieval process"
  }
}
```

### Success Response Indicators
- HTTP Status: `200 OK`
- `metadata.isComparison`: `true`
- `metadata.comparisonValid`: `true`
- `content`: Non-empty string containing structured Markdown

### Error Response Indicators
- HTTP Status: `200 OK` (graceful error handling)
- `metadata.isComparison`: `true` or `false`
- `metadata.comparisonValid`: `false` (if comparison-related error)
- `content`: User-friendly error message or guidance

## Markdown Content Structure

### Required Section Hierarchy

#### 1. Main Header (H2)
```markdown
## Switch Comparison: [Switch 1] vs [Switch 2] [vs Switch 3]
```
**Requirements**:
- Must use H2 (`##`) for main header
- Include actual switch names being compared
- Format: "Switch Comparison: X vs Y" or "Switch Comparison: X vs Y vs Z"

#### 2. Overview Section (H3)
```markdown
### Overview
[Brief 2-3 sentence summary of the key differences and similarities]
```
**Content Requirements**:
- Concise introduction to the comparison
- Highlight 1-2 primary differences
- Set context for detailed analysis

#### 3. Technical Specifications Section (H3)
```markdown
### Technical Specifications

| Specification | [Switch 1] | [Switch 2] | [Switch 3] |
|---------------|------------|------------|------------|
| Manufacturer  | [Value]    | [Value]    | [Value]    |
| Type          | [Value]    | [Value]    | [Value]    |
| Top Housing   | [Value]    | [Value]    | [Value]    |
| Bottom Housing| [Value]    | [Value]    | [Value]    |
| Stem          | [Value]    | [Value]    | [Value]    |
| Mount         | [Value]    | [Value]    | [Value]    |
| Spring        | [Value]    | [Value]    | [Value]    |
| Actuation Force (g) | [Value] | [Value] | [Value] |
| Bottom-out Force (g) | [Value] | [Value] | [Value] |
| Pre-travel (mm) | [Value] | [Value] | [Value] |
| Total Travel (mm) | [Value] | [Value] | [Value] |
```

**Formatting Requirements**:
- Use pipe-separated tables with proper alignment
- Include table header separator row (`|---|---|---|`)
- Use "N/A" for missing data
- Include units for numerical values (g, mm)
- All switch names should match those in the header

#### 4. In-Depth Analysis Section (H3)
```markdown
### In-Depth Analysis

#### Housing Materials
[Detailed comparison of top/bottom housing materials and their impact]

#### Force & Weighting
[Analysis of actuation and bottom-out forces, spring characteristics]

#### Travel & Actuation
[Comparison of pre-travel, total travel, and actuation points]

#### Sound Profile
[Sound characteristics, acoustics, and noise levels]

#### Feel & Tactility
[Tactile feedback, smoothness, and user experience]

#### Use Case Suitability
[Gaming vs typing recommendations, specific scenarios]
```

**Content Requirements**:
- Each subsection must use H4 (`####`) headers
- Provide specific details, not just generalizations
- Compare and contrast between switches
- Include technical reasoning for differences
- Address practical implications

#### 5. Typing Experience Summary (H3)
```markdown
### Typing Experience Summary
[2-3 paragraph summary of the overall typing experience with each switch]
```
**Content Requirements**:
- Synthesize technical details into user experience
- Address both gaming and typing scenarios
- Consider long-term usage implications

#### 6. Conclusion (H3)
```markdown
### Conclusion
[Final recommendation with specific use case guidance]
```
**Content Requirements**:
- Clear recommendation for different user types
- Specific scenarios where each switch excels
- Decision-making guidance
- No ambiguous conclusions

## Content Quality Standards

### Technical Accuracy
- Specifications must match database values when available
- Missing data clearly marked as "N/A"
- Units consistently applied (grams for force, millimeters for distance)
- General knowledge sources properly attributed

### Writing Quality
- Professional, informative tone
- Clear, concise language
- Logical flow between sections
- No marketing language or bias

### Markdown Formatting
- Consistent heading hierarchy (H2 → H3 → H4)
- Proper table formatting with alignment
- Appropriate use of **bold** and *italic* text
- Clean, readable structure

## Response Length Requirements

### Token Limits
- Maximum: 1500 tokens (approximately 6000 characters)
- Typical range: 800-1200 tokens
- Minimum viable: 500 tokens

### Content Distribution
- Overview: ~50-100 tokens
- Technical Specifications: ~200-300 tokens
- In-Depth Analysis: ~400-600 tokens
- Typing Experience: ~100-200 tokens
- Conclusion: ~50-100 tokens

## Missing Data Handling

### Database Missing Switches
When a switch is not found in the database:
```markdown
**Note**: [Switch Name] was not found in our database. The following analysis is based on general community knowledge and typical specifications for this switch type.
```

### Missing Specifications
For missing individual fields:
- Use "N/A" in tables
- Note missing data in relevant analysis sections
- Provide general knowledge when appropriate with attribution

### Attribution Templates
- "Based on general community understanding..."
- "According to typical specifications for this switch type..."
- "Community reports suggest..."
- "General characteristics of [brand/type] switches indicate..."

## Validation Checklist

### Structure Validation
- [ ] H2 main header with switch names
- [ ] All 5 required H3 sections present
- [ ] 6 H4 subsections in In-Depth Analysis
- [ ] Proper table formatting
- [ ] Consistent heading hierarchy

### Content Validation
- [ ] Technical specifications table complete
- [ ] All switch names mentioned in content
- [ ] Missing data properly marked
- [ ] Actionable recommendations provided
- [ ] Professional tone maintained

### Format Validation
- [ ] Valid Markdown syntax
- [ ] Table headers aligned
- [ ] Consistent use of bold/italic
- [ ] Proper list formatting
- [ ] No broken formatting

### Length Validation
- [ ] Response within 1500 token limit
- [ ] Sufficient detail in each section
- [ ] Balanced content distribution
- [ ] No unnecessary verbosity

## Example Snippets

### Good Overview Example
```markdown
### Overview

The Gateron Oil King and Cherry MX Red represent two distinct approaches to linear switching. While both offer smooth keystroke experiences, the Oil King emphasizes premium feel with factory lubrication and modern housing materials, whereas the Cherry MX Red focuses on proven reliability and widespread compatibility. The primary differences lie in their force curves, sound profiles, and overall build quality.
```

### Good Technical Specifications Example
```markdown
### Technical Specifications

| Specification | Gateron Oil King | Cherry MX Red |
|---------------|------------------|---------------|
| Manufacturer  | Gateron          | Cherry        |
| Type          | Linear           | Linear        |
| Top Housing   | Nylon            | Nylon         |
| Bottom Housing| Nylon            | Nylon         |
| Stem          | POM              | POM           |
| Actuation Force (g) | 55g       | 45g           |
| Bottom-out Force (g) | 65g      | 75g           |
| Pre-travel (mm) | 2.0mm         | 2.0mm         |
| Total Travel (mm) | 4.0mm       | 4.0mm         |
```

### Good In-Depth Analysis Example
```markdown
#### Force & Weighting

The force characteristics reveal a fundamental difference in typing philosophy. The Gateron Oil King requires 55g of actuation force compared to the Cherry MX Red's 45g, making it slightly heavier and more deliberate. However, the Oil King's 65g bottom-out force is actually lighter than the Cherry's 75g, creating a more progressive force curve that many typists find comfortable for extended sessions.
```

## Error Response Examples

### Insufficient Switches
```json
{
  "content": "I found \"Cherry MX Blue\" in your query. For a comparison, I need at least two switches. Would you like to specify another switch to compare it with, or would you prefer general information about Cherry MX Blue?",
  "metadata": {
    "isComparison": true,
    "comparisonValid": false
  }
}
```

### No Switches Found
```json
{
  "content": "I couldn't find any of the switches you mentioned in our database. This could be due to misspelled switch names or switches not yet in our database. Could you please check the switch names and try again?",
  "metadata": {
    "isComparison": true,
    "comparisonValid": false,
    "error": "no_switches_found"
  }
}
```

---

*This documentation ensures consistent, high-quality comparison responses that meet all PRD requirements and provide excellent user experience.* 